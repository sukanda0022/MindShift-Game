<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindShift - ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏£‡∏π‡∏°</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö (Layering) --- */

        .screen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô none ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            text-align: center;
            font-family: 'Kanit', sans-serif;
        }

        /* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤ Lobby ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß */
        #lobby-screen {
            display: flex; 
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 3000 !important;
        }

        .modal-content {
            background: white;
            color: #333;
            padding: 25px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .lobby-container,
        .setup-container {
            background: #2c3e50;
            padding: 30px;
            border-radius: 20px;
            border: 4px solid #4db6ac;
            width: 90%;
            max-width: 400px;
        }

        .game-btn {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: 0.2s;
        }

        .primary {
            background: #4db6ac;
            color: white;
            box-shadow: 0 4px #00897b;
        }

        .secondary {
            background: #ffb74d;
            color: white;
            box-shadow: 0 4px #f57c00;
        }

        .info {
            background: #4fc3f7;
            color: white;
            box-shadow: 0 4px #0288d1;
        }

        .danger {
            background: #e57373;
            color: white;
            box-shadow: 0 4px #d32f2f;
        }

        .time-btn {
            background: #37474f;
            color: white;
            border: 2px solid #4db6ac;
            margin: 5px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }

        #reset-btn {
            display: none;
            margin: 0 auto;
            padding: 12px 25px;
            background-color: #ff4d8d;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Kanit', sans-serif;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 77, 141, 0.4);
            position: relative;
            z-index: 100;
            pointer-events: auto;
        }

        .redeem-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-redeem-item {
            padding: 20px 10px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-family: 'Kanit', sans-serif;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .btn-redeem-small {
            background: #fce4ec;
            color: #ad1457;
            border: 2px solid #f8bbd0;
        }

        .btn-redeem-large {
            background: #f3e5f5;
            color: #6a1b9a;
            border: 2px solid #e1bee7;
        }

        .redeem-price {
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* --- ‚ú® ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ï‡πâ‡πÄ‡∏û‡∏ä‡∏£ ‚ú® --- */
        .hud-action-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
            align-items: flex-end;
        }

        .btn-hud-small {
            border: none;
            padding: 6px 12px;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            font-family: 'Kanit', sans-serif;
            font-size: 0.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: 0.2s;
            width: fit-content;
        }

        .btn-hud-small.stats { background: linear-gradient(135deg, #4fc3f7, #0288d1); }
        .btn-hud-small.logout { background: linear-gradient(135deg, #ff8a80, #d32f2f); }

        .btn-hud-small:hover { transform: scale(1.05); filter: brightness(1.1); }
        .btn-hud-small:active { transform: scale(0.95); }
    </style>
</head>

<body class="game-body">

    <div id="lobby-screen" class="screen-overlay">
        <div class="lobby-container">
            <h1 style="color: #4db6ac; margin-bottom: 5px;">MIND SHIFT</h1>
            <p style="margin-bottom: 20px;">üéì <span id="lobby-name">...</span></p>
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°: <span id="lobby-pts" style="color: #ffd700; font-weight: bold;">0</span> üíé
            </div>
            <button class="game-btn primary" onclick="handleShowSetup()">üéÆ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
            <button class="game-btn secondary" onclick="window.openShop()">üõí ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</button>
            <button class="game-btn info" onclick="window.showStatistics()">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÇ‡∏ü‡∏Å‡∏±‡∏™</button>
            <button class="game-btn danger" onclick="window.logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>

    <div id="setup-screen" class="screen-overlay">
        <div class="setup-container">
            <h2 style="color: #4db6ac;">‚è±Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
            <p style="margin-bottom: 20px;">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏•‡∏∞ 30 ‡∏ô‡∏≤‡∏ó‡∏µ</p>
            <div class="time-options">
                <button class="time-btn" onclick="window.selectDuration(60)">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (2 ‡∏ä‡πà‡∏ß‡∏á)</button>
                <button class="time-btn" onclick="window.selectDuration(120)">2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (4 ‡∏ä‡πà‡∏ß‡∏á)</button>
                <button class="time-btn" onclick="window.selectDuration(180)">3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (6 ‡∏ä‡πà‡∏ß‡∏á)</button>
            </div>
            <button class="game-btn danger" onclick="handleHideSetup()" style="margin-top: 20px;">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        </div>
    </div>

    <div class="game-content-wrapper" id="main-game-area" style="display: none;">
        <div class="top-hud">
            <div class="hud-item timer-box">‚è±Ô∏è <span id="timer">30:00</span></div>
            <div class="hud-item energy-container">
                <div class="energy-bar-bg">
                    <div id="energy-fill" class="energy-fill"></div>
                </div>
            </div>
            
            <div style="display: flex; flex-direction: column; align-items: flex-end;">
                <div class="hud-item points-box">üíé <span id="pts">0</span></div>
                
                <div class="hud-action-group">
                    <button class="btn-hud-small stats" onclick="window.showStatistics()">
                        üìä <span>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</span>
                    </button>
                    <button class="btn-hud-small logout" onclick="window.logout()">
                        üö™ <span>‡∏≠‡∏≠‡∏Å</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="character-layer">
            <div class="status-group">
                <div id="status-msg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏™‡∏°‡∏≤‡∏ò‡∏¥... ‚ú®</div>
                <button id="reset-btn" onclick="window.restartSession()">üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</button>
            </div>
            <img id="main-character-img" src="images/girl_1.png" alt="Character">
        </div>

        <div class="bottom-nav">
            <div id="student-name-display" class="user-pill">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</div>
            <div class="nav-buttons-group">
                <button class="btn-action shop" onclick="window.openShop()">üõí ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                <button class="btn-action redeem" onclick="openRedeemModal()">üéÅ ‡πÅ‡∏•‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>
            </div>
        </div>
    </div>

    <div id="redeem-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üéÅ ‡πÅ‡∏•‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</h3>
                <div class="points-badge">‡πÅ‡∏ï‡πâ‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="current-points">0</span></div>
            </div>
            <div class="redeem-grid">
                <button class="btn-redeem-item btn-redeem-small" onclick="window.processRedeem(50)">
                    <span>üéÄ ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏¢‡πà‡∏≠‡∏¢</span>
                    <span class="redeem-price">50 ‡πÅ‡∏ï‡πâ‡∏°</span>
                </button>
                <button class="btn-redeem-item btn-redeem-large" onclick="window.processRedeem(100)">
                    <span>üèÜ ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏ç‡πà</span>
                    <span class="redeem-price">100 ‡πÅ‡∏ï‡πâ‡∏°</span>
                </button>
            </div>
            <div class="modal-footer" style="margin-top: 20px; text-align: right;">
                <button class="btn-close-modal" onclick="closeRedeemModal()">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
            </div>
        </div>
    </div>

    <div id="shop-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="shop-tabs">
                    <button class="tab-btn active" onclick="window.switchShopTab('skins')">üëó ‡∏ä‡∏∏‡∏î‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</button>
                    <button class="tab-btn" onclick="window.switchShopTab('backgrounds')">üñºÔ∏è ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</button>
                </div>
                <span class="points-badge">üíé <span id="shop-pts-balance">0</span> ‡πÅ‡∏ï‡πâ‡∏°</span>
            </div>
            <div class="shop-grid">
                <div class="preview-area">
                    <div class="preview-card"><img id="shop-preview-img" src=""></div>
                    <p id="preview-item-name" style="color: #333;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö</p>
                </div>
                <div class="items-list"></div>
            </div>
            <div class="modal-footer" style="margin-top: 20px; text-align: right;">
                <button class="btn-buy" id="confirm-buy-btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</button>
                <button class="btn-close-modal" onclick="window.closeShop()">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="game-logic.js"></script>

    <script>
        // --- üü¢ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ üü¢ ---
        function handleShowSetup() {
            playSfx('tap');
            document.getElementById('lobby-screen').style.setProperty('display', 'none', 'important');
            document.getElementById('setup-screen').style.setProperty('display', 'flex', 'important');
        }

        function handleHideSetup() {
            playSfx('tap');
            document.getElementById('setup-screen').style.setProperty('display', 'none', 'important');
            document.getElementById('lobby-screen').style.setProperty('display', 'flex', 'important');
        }

        window.handleShowSetup = handleShowSetup;
        window.handleHideSetup = handleHideSetup;

        const sfx = {
            tap: new Audio('https://actions.google.com/sounds/v1/foley/button_click.ogg')
        };

        function playSfx(name) {
            if (sfx[name]) {
                sfx[name].currentTime = 0;
                sfx[name].play().catch(() => { });
            }
        }

        function openRedeemModal() {
            playSfx('tap');
            document.getElementById('redeem-modal').style.display = 'flex';
        }

        function closeRedeemModal() {
            playSfx('tap');
            document.getElementById('redeem-modal').style.display = 'none';
        }

        document.addEventListener('click', (e) => {
            if (e.target.closest('button')) playSfx('tap');
        });

        document.addEventListener('DOMContentLoaded', () => {
            const savedName = localStorage.getItem('ms_name') || "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô";
            if (document.getElementById('lobby-name')) document.getElementById('lobby-name').textContent = savedName;
            if (document.getElementById('student-name-display')) document.getElementById('student-name-display').textContent = savedName;
        });

        // --- ‚ú® ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ "‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ" ‚ú® ---
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏Ñ‡∏≠‡∏¢‡πÄ‡∏ä‡πá‡∏Ñ LocalStorage ‡∏ñ‡πâ‡∏≤‡πÇ‡∏î‡∏ô‡∏™‡∏±‡πà‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å Logic ‡∏´‡∏•‡∏±‡∏Å ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Login ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        window.addEventListener('storage', (e) => {
            if (e.key === null) { // ‡∏Å‡∏£‡∏ì‡∏µ‡πÇ‡∏î‡∏ô localStorage.clear()
                window.location.href = 'index.html';
            }
        });
    </script>
</body>

</html>